# 🚀 SageMaker Training Jobs 複数パターンテストガイド

Training Jobsで様々なパターンをテストし、最適な設定を見つけるためのツールセットです。

## 📁 追加されたファイル

```
sagemaker-lecture-version/
├── run_multiple_patterns.py              # 🎯 メイン実行スクリプト
├── multiple_training_patterns.py         # 🔧 コア機能
├── training_patterns_config.py           # ⚙️ テストパターン設定
├── train_lecture_extended.py             # 🤖 拡張トレーニングスクリプト
└── MULTIPLE_PATTERNS_GUIDE.md            # 📖 このガイド
```

## 🎯 テストパターンの種類

### 1. 📊 インスタンスタイプ比較
異なるインスタンスタイプでの性能とコストを比較

```python
テスト対象:
├── ml.m5.large   ($0.115/時間)
├── ml.m5.xlarge  ($0.230/時間)
├── ml.c5.large   ($0.108/時間)
└── ml.c5.xlarge  ($0.216/時間)

比較項目:
├── 実行時間
├── コスト
└── 性能効率
```

### 2. ⚙️ ハイパーパラメータ比較
GridSearchや並列処理設定の影響を比較

```python
テスト対象:
├── GridSearch有効 vs 無効
├── 並列処理数 (1, 2, -1)
└── 最適化レベル

比較項目:
├── 訓練時間
├── モデル精度
└── リソース使用効率
```

### 3. 🤖 アルゴリズム比較
異なるアルゴリズムに特化した設定での比較

```python
テスト対象:
├── RandomForest特化
├── GradientBoosting特化
└── LogisticRegression特化

比較項目:
├── 精度
├── 訓練時間
└── 特徴量重要度
```

### 4. 🏃 性能テスト
大規模インスタンスでの性能限界テスト

```python
テスト対象:
├── ml.m5.large
└── ml.m5.2xlarge

比較項目:
├── スケーラビリティ
├── コストパフォーマンス
└── 処理能力限界
```

### 5. 💰 コスト最適化テスト
最小コストでの実行設定を探索

```python
テスト対象:
├── 軽量設定 (GridSearch無効)
├── 最小インスタンス (ml.t3.medium)
└── クイックモード

比較項目:
├── 最小コスト
├── 許容精度
└── 実行時間
```

## 🚀 使用方法

### 基本的な実行
```bash
# メインスクリプトを実行
python3 run_multiple_patterns.py

# メニューから選択
1. インスタンスタイプ比較
2. ハイパーパラメータ比較
3. アルゴリズム比較
4. カスタム設定
5. 性能テスト
6. コスト最適化テスト
```

### 実行設定
```bash
並列実行: y/n (推奨: y)
最大並列数: 1-5 (推奨: 3)
```

### 実行例
```bash
$ python3 run_multiple_patterns.py

🚀 SageMaker Training Jobs 複数パターンテスト
============================================================

実行するテストパターンを選択してください:
1. 📊 インスタンスタイプ比較
2. ⚙️ ハイパーパラメータ比較
...

選択 (0-7): 1

📊 実行予測:
  実行パターン数: 4
  予想実行時間: 約15分/ジョブ
  予想総コスト: $0.0920

並列実行しますか？ (y/n) [推奨: y]: y
最大並列数 (1-5) [デフォルト: 3]: 3

4個のTraining Jobsを実行しますか？ (y/n): y
```

## 📊 結果の分析

### 自動生成される分析レポート
```bash
🎯 Training Jobs 複数パターン実行結果
=====================================

📊 実行統計:
  総実行数: 4
  成功数: 4
  失敗数: 0

⏱️ 実行時間統計:
  平均実行時間: 892.3秒
  最短実行時間: 756.2秒
  最長実行時間: 1024.1秒

💰 コスト統計:
  総コスト: $0.0856
  平均コスト: $0.0214
  最小コスト: $0.0189
  最大コスト: $0.0245

📋 詳細結果:
        name instance_type  total_time    cost
  ml.m5.large    ml.m5.large       756.2  0.0189
 ml.m5.xlarge   ml.m5.xlarge       892.1  0.0234
  ml.c5.large    ml.c5.large       834.7  0.0198
 ml.c5.xlarge   ml.c5.xlarge      1024.1  0.0245

🏆 推奨設定:
  最速実行: ml.m5.large (756.2秒)
  最安実行: ml.m5.large ($0.0189)
```

### 結果ファイル
```bash
training_patterns_results_20250814_015530.json
├── 全実行結果の詳細データ
├── エラー情報
├── モデルアーティファクトパス
└── 実行統計
```

## 💡 実践的な活用例

### 1. 最適インスタンス選択
```python
# 目的: コストパフォーマンス最適化
実行: インスタンスタイプ比較
結果: ml.m5.large が最適
理由: 実行時間とコストのバランス
```

### 2. ハイパーパラメータ調整
```python
# 目的: 精度向上 vs 時間短縮
実行: ハイパーパラメータ比較
結果: GridSearch有効 + 並列数2が最適
理由: 精度向上とリソース効率のバランス
```

### 3. アルゴリズム選択
```python
# 目的: データに最適なアルゴリズム発見
実行: アルゴリズム比較
結果: GradientBoosting が最高精度
理由: 複雑なパターンを効果的に学習
```

## ⚠️ 注意事項

### コスト管理
```bash
⚠️ 複数のTraining Jobsを並列実行するため、コストが発生します
💡 小規模テストから始めることを推奨
📊 実行前に必ずコスト予測を確認
```

### 実行時間
```bash
⏱️ 各ジョブは10-20分程度かかります
🔄 並列実行により総時間は短縮されます
📱 長時間実行の場合は通知設定を推奨
```

### リソース制限
```bash
🏗️ 同時実行可能なTraining Jobs数に制限があります
📊 デフォルトで最大3並列に設定
⚙️ 必要に応じてAWSサポートに制限緩和を依頼
```

## 🔧 カスタマイズ

### 新しいテストパターンの追加
```python
# training_patterns_config.py に追加
def get_my_custom_configs():
    return [
        {
            'name': 'My-Custom-Test',
            'entry_point': 'train_lecture_extended.py',
            'instance_type': 'ml.m5.large',
            'hyperparameters': {
                'custom-param': 'value'
            },
            'job_name_prefix': 'my-custom-test'
        }
    ]
```

### 新しいインスタンスタイプの追加
```python
# multiple_training_patterns.py の instance_costs に追加
instance_costs = {
    'ml.m5.large': 0.115,
    'ml.my.new.instance': 0.XXX  # 新しいインスタンス
}
```

## 📈 次のステップ

### 結果を活用した最適化
1. **最適設定の特定**: テスト結果から最適な設定を選択
2. **本番環境適用**: 最適設定を本番パイプラインに適用
3. **継続的改善**: 定期的なテストで設定を更新

### 高度な活用
1. **A/Bテスト**: 複数設定での本番比較
2. **自動最適化**: 結果に基づく自動設定調整
3. **MLOps統合**: パイプラインでの自動テスト実行

---

**🎯 このツールセットにより、Training Jobsの最適な設定を効率的に発見し、コストパフォーマンスを最大化できます！**
